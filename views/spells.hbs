{{#if error}}
<div class="d-flex justify-content-center mt-4">
  <div id="alert" class="alert alert-danger w-50 " role="alert">
    <div class="d-flex">
      <h4 class="alert-heading">{{status}} Error</h4>
      <button style="margin-left: auto" type="button" class="btn-close" data-bs-dismiss="alert"
        aria-label="Close"></button>
    </div>
    <p>{{error}}</p>
  </div>
</div>
{{/if}}
{{#if warning}}
<div class="d-flex justify-content-center mt-4">
  <div id="alert" class="alert alert-warning w-50 " role="alert">
    <div class="d-flex">
      <h4 class="alert-heading">Warning</h4>
      <button style="margin-left: auto" type="button" class="btn-close" data-bs-dismiss="alert"
        aria-label="Close"></button>
    </div>
    <p>{{warning}}</p>
  </div>
</div>
{{/if}}
{{#if confirmation}}


{{!-- Filtering section --}}
<form id="additionForm" class="bg-dark my-5" action="/spells/filter" method="GET">

  <div id="top" class="d-flex">
    <div id="left" class="container d-flex flex-column justify-content-around py-5 align-items-center">
      <div>
        <label for="schoolIdPicker">School</label>
        {{!-- School picker --}}
        <select name="SchoolId" id="schoolIdPicker">
          <option value="" selected>Any</option>
          {{#each schools}}
          <option {{#if (numEquals ../filter.SchoolId Id)}} selected {{/if}} value="{{Id}}">{{Name}}</option>
          {{/each}}
        </select>
      </div>

      {{!-- Level picker --}}
      <div class="m-2">
        <label for="levelPicker">Level</label>
        <select name="Level" id="levelPicker">
          <option value="" selected>Any</option>
          <option {{#if (numEquals filter.Level 0)}} selected {{/if}} value="0">Cantrip</option>
          <option {{#if (numEquals filter.Level 1)}} selected {{/if}} value="1">1</option>
          <option {{#if (numEquals filter.Level 2)}} selected {{/if}} value="2">2</option>
          <option {{#if (numEquals filter.Level 3)}} selected {{/if}} value="3">3</option>
          <option {{#if (numEquals filter.Level 4)}} selected {{/if}} value="4">4</option>
          <option {{#if (numEquals filter.Level 5)}} selected {{/if}} value="5">5</option>
          <option {{#if (numEquals filter.Level 6)}} selected {{/if}} value="6">6</option>
          <option {{#if (numEquals filter.Level 7)}} selected {{/if}} value="7">7</option>
          <option {{#if (numEquals filter.Level 8)}} selected {{/if}} value="8">8</option>
          <option {{#if (numEquals filter.Level 9)}} selected {{/if}} value="9">9</option>
        </select>
      </div>

      {{!-- Name --}}
      <div class="m-2">
        <label for="spellName">Name</label>
        <input type="text" name="Name" id="spellName" {{#if filter.Name}}value="{{filter.Name}}" {{/if}}>
      </div>

      {{!-- Classes that can cast this spell --}}
      <div class="d-flex align-items-center flex-column justify-content-center">
        <label for="filterByClass">Filter by class?</label>
        <input type="checkbox" name="filterByClass" id="filterByClass" {{#if filter.Classes}}checked{{/if}}>
        <div class="d-flex flex-column align-items-center" {{#if filter.Classes}}{{else}}style="visibility: hidden;"
          {{/if}} id="classFilteringDiv">
          <h3 class="mt-2">Can be cast by...</h3>
          <div class="d-flex flex-wrap" class="d-flex flex-align-between flex-wrap">
            {{#each Classes}}
            <div class="px-4">
              <p>{{Name}}</p>
              <input type="checkbox" class="classCheckbox" value="{{Id}}"
                {{#if (stringIn Id ../filter.Classes)}}checked{{/if}}>
            </div>
            {{/each}}
            <input type="text" hidden id="castableClasses" name="ClassIds">
          </div>
        </div>
      </div>
    </div>
    <div class="container d-flex flex-column justify-content-around py-5 align-items-center w-100">
      {{!-- Casting Time --}}
      <div id="castingTimeDiv" class="m-2">
        <label for="castingTime">Casting Time</label>
        <select name="CastingTime" id="castingTime">
          <option value="" selected>Any</option>
          <option {{#if (equals filter.CastingTime "1 action")}}selected{{/if}} value="1 action">1 action</option>
          <option {{#if (equals filter.CastingTime "1 bonus action")}}selected{{/if}} value="1 bonus action">1 bonus
            action</option>
          <option {{#if (equals filter.CastingTime "1 reaction")}}selected{{/if}} value="1 reaction">1 reaction</option>
          <option {{#if (equals filter.CastingTime "1 minute")}}selected{{/if}} value="1 minute">1 minute</option>
          <option {{#if (equals filter.CastingTime "10 minutes")}}selected{{/if}} value="10 minutes">10 minutes</option>
          <option {{#if (equals filter.CastingTime "1 hour")}}selected{{/if}} value="1 hour">1 hour</option>
          <option
            {{#if (isNoneOf filter.CastingTime '["1 action","1 bonus action","1 reaction","1 minute","10 minutes","1 hour",null]')}}selected{{/if}}
            value="Custom">Custom</option>
        </select>
        <input
          {{#if (isNoneOf filter.CastingTime '["1 action","1 bonus action","1 reaction","1 minute","10 minutes","1 hour",null]')}}value="{{filter.CastingTime}}"
          {{else}}style="visibility: hidden;" {{/if}} type="text" id="customCastingTime" name="customCastingTime">
      </div>

      {{!-- Components --}}
      <div id="componentsDiv" class="m-2 d-flex align-items-center flex-column">
        <h2>Components</h2>
        <div>
          <label for="includeVerbal">Filter by Verbal?</label>
          <input type="checkbox" name="includeVerbal" id="includeVerbal" {{#if filter.includeVerbal}}checked{{/if}}>
          <label {{#if filter.includeVerbal}}{{else}}style="visibility:hidden;" {{/if}} id="verbalLabel"
            for="verbalButton">Verbal</label>
          <input {{#if filter.includeVerbal}}{{else}}style="visibility:hidden;" {{/if}} type="checkbox" name="Verbal"
            id="verbalButton" {{#if filter.Verbal}}checked{{/if}}>
        </div>

        <div>
          <label for="includeSomatic">Filter by Somatic?</label>
          <input type="checkbox" name="includeSomatic" id="includeSomatic" {{#if filter.includeSomatic}}checked{{/if}}>
          <label {{#if filter.includeSomatic}}{{else}}style="visibility:hidden;" {{/if}} id="somaticLabel"
            for="somaticButton">Somatic</label>
          <input {{#if filter.includeSomatic}}{{else}}style="visibility:hidden;" {{/if}} type="checkbox" name="Somatic"
            id="somaticButton" {{#if filter.Somatic}}checked{{/if}}>
        </div>

        <div>
          <label for="includeMaterial">Filter by Material?</label>
          <input type="checkbox" name="includeMaterial" id="includeMaterial"
            {{#if filter.includeMaterial}}checked{{/if}}>
          <label {{#if filter.includeMaterial}}{{else}}style="visibility:hidden;" {{/if}} id="materialLabel"
            for="materialButton">Material</label>
          <input {{#if filter.includeMaterial}}{{else}}style="visibility:hidden;" {{/if}} type="checkbox"
            name="Material" id="materialButton" {{#if filter.Material}}checked{{/if}}>
        </div>
      </div>

      {{!-- Duration --}}
      <div id="durationDiv" class="m-2">
        <label for="durationSelect">Duration</label>
        <select name="Duration" id="durationSelect">
          <option value="" selected>Any</option>
          <option {{#if (equals filter.Duration "Instantaneous")}}selected{{/if}} value="Instantaneous">Instantaneous
          </option>
          <option {{#if (equals filter.Duration "1 Round")}}selected{{/if}} value="1 Round">1 Round</option>
          <option {{#if (equals filter.Duration "1 Minute")}}selected{{/if}} value="1 Minute">1 Minute</option>
          <option {{#if (equals filter.Duration "10 Minutes")}}selected{{/if}} value="10 Minutes">10 Minutes</option>
          <option {{#if (equals filter.Duration "30 Minutes")}}selected{{/if}} value="30 Minutes">30 Minutes</option>
          <option {{#if (equals filter.Duration "1 Hour")}}selected{{/if}} value="1 Hour">1 Hour</option>
          <option {{#if (equals filter.Duration "8 Hours")}}selected{{/if}} value="8 Hours">8 Hours</option>
          <option
            {{#if (isNoneOf filter.Duration '["Instantaneous","1 Round","1 reaction","1 Minute","10 minutes","30 Minutes","1 hour","8 Hours",null]')}}selected{{/if}}
            value="Custom">Custom</option>
        </select>
        <input
          {{#if (isNoneOf filter.Duration '["Instantaneous","1 Round","1 reaction","1 Minute","10 minutes","30 Minutes","1 hour","8 Hours",null]')}}value="{{filter.Duration}}"
          {{else}}style="visibility: hidden;" {{/if}} type="text" id="customDuration" name="customDuration">
      </div>

      {{!-- Range --}}
      <div id="rangeDiv" class="m-2">
        <label for="rangeInput">Range</label>
        <select name="EffectRange" id="rangeInput">
          <option value="" selected>Any</option>
          <option {{#if (equals filter.EffectRange "Self")}}selected{{/if}} value="Self">Self</option>
          <option {{#if (equals filter.EffectRange "5 Feet")}}selected{{/if}} value="5 Feet">5 Feet</option>
          <option {{#if (equals filter.EffectRange "30 Feet")}}selected{{/if}} value="30 Feet">30 Feet</option>
          <option {{#if (equals filter.EffectRange "60 Feet")}}selected{{/if}} value="60 Feet">60 Feet</option>
          <option {{#if (equals filter.EffectRange "120 Feet")}}selected{{/if}} value="120 Feet">120 Feet</option>
          <option
            {{#if (isNoneOf filter.EffectRange '["Self","5 Feet","30 Feet","60 Feet","120 Feet", null]')}}selected{{/if}}
            value="Custom">Custom</option>
        </select>
        <input
          {{#if (isNoneOf filter.EffectRange '["Self","5 Feet","30 Feet","60 Feet","120 Feet", null]')}}value="{{filter.EffectRange}}"
          {{else}}style="visibility: hidden;" {{/if}} type="text" id="customRange" name="customRange">
      </div>

      <div id="concentrationDiv" class="m-2 w-100 text-center">
        <label for="includeConcentration">Filter by Concentration?</label>
        <input type="checkbox" id="includeConcentration" name="includeConcentration"
          {{#if filter.includeConcentration}}checked{{/if}}>
        <label {{#if filter.includeConcentration}}{{else}}style="visibility:hidden;" {{/if}} id="concentrationLabel"
          for="Concentration">Concentration</label>
        <input {{#if filter.includeConcentration}}{{else}}style="visibility:hidden;" {{/if}} type="checkbox"
          name="Concentration" id="Concentration" {{#if filter.Concentration}}checked{{/if}}>
      </div>

      <div id="ritualDiv" class="m-2 w-100 text-center">
        <label for="includeRitual">Filter by Ritual?</label>
        <input type="checkbox" id="includeRitual" name="includeRitual" {{#if filter.includeRitual}}checked{{/if}}>
        <label {{#if filter.includeRitual}}{{else}}style="visibility:hidden;" {{/if}} id="ritualLabel"
          for="Ritual">Ritual</label>
        <input {{#if filter.includeRitual}}{{else}}style="visibility:hidden;" {{/if}} type="checkbox" name="Ritual"
          id="Ritual" {{#if filter.Ritual}}checked{{/if}}>
      </div>

      {{#if username}}
      <div class="m-2 w-100 text-center">
        <label for="includeHomebrewed">Filter by Homebrew?</label>
        <input type="checkbox" id="includeHomebrew" name="includeHomebrew" {{#if filter.includeHomebrew}}checked{{/if}}>
        <div id="homebrewDiv" {{#if filter.includeHomebrew}}{{else}}style="visibility:hidden;" {{/if}} class="m-2">
          <label id="homebrewLabel" for="Homebrew">Homebrew</label>
          <input type="checkbox" name="Homebrew" id="Homebrew" {{#if filter.Homebrew}}checked{{/if}}>
        </div>
      </div>
      {{/if}}
    </div>

  </div>
  <div class="d-flex justify-content-center">
    <button class="btn btn-primary">Filter</button>
  </div>
</form>
<script src="/scripts/spellsPage.js"></script>
<script>
  const somaticIncluded = document.getElementById('includeSomatic');
  const materialIncluded = document.getElementById('includeMaterial');
  const verbalIncluded = document.getElementById('includeVerbal');
  const concentrationIncluded = document.getElementById('includeConcentration');
  const ritualIncluded = document.getElementById('includeRitual');
  const classFilteringIncluded = document.getElementById('filterByClass');
  const homebrewIncluded = document.getElementById('includeHomebrew');
  const somaticChoice = document.getElementById('somaticButton');
  const materialChoice = document.getElementById('materialButton');
  const verbalChoice = document.getElementById('verbalButton');
  const concentrationChoice = document.getElementById('Concentration');
  const ritualChoice = document.getElementById('Ritual');
  const classFilteringDiv = document.getElementById('classFilteringDiv');
  const homebrewDiv = document.getElementById('homebrewDiv')

  homebrewIncluded.addEventListener('change', e => {
    homebrewDiv.style.visibility = homebrewIncluded.checked ? 'visible' : 'hidden';
  })

  classFilteringIncluded.addEventListener('change', e => {
    classFilteringDiv.style.visibility = classFilteringIncluded.checked ? 'visible' : 'hidden';
  })

  ritualIncluded.addEventListener('change', e => {
    ritualChoice.style.visibility = ritualIncluded.checked ? 'visible' : 'hidden';
    document.getElementById('ritualLabel').style.visibility = ritualIncluded.checked ? 'visible' : 'hidden';
  })

  concentrationIncluded.addEventListener('change', e => {
    concentrationChoice.style.visibility = concentrationIncluded.checked ? 'visible' : 'hidden';
    document.getElementById('concentrationLabel').style.visibility = concentrationIncluded.checked ? 'visible' : 'hidden';
  })

  somaticIncluded.addEventListener('change', e => {
    somaticChoice.style.visibility = somaticIncluded.checked ? 'visible' : 'hidden';
    document.getElementById('somaticLabel').style.visibility = somaticIncluded.checked ? 'visible' : 'hidden';
  })

  materialIncluded.addEventListener('change', e => {
    materialChoice.style.visibility = materialIncluded.checked ? 'visible' : 'hidden';
    document.getElementById('materialLabel').style.visibility = materialIncluded.checked ? 'visible' : 'hidden';
  })

  verbalIncluded.addEventListener('change', e => {
    verbalChoice.style.visibility = verbalIncluded.checked ? 'visible' : 'hidden';
    document.getElementById('verbalLabel').style.visibility = verbalIncluded.checked ? 'visible' : 'hidden';
  })

</script>
<h1 class="text-center mt-0">Spells</h1>
<div class="d-flex flex-wrap  justify-content-center">
  {{#each spells}}
  <form action="/spells/{{Id}}" class="d-flex flex-row bg-card card-btn m-4 characterForm spellForm w-25" style="width: 50;">
  <div class="card-header d-flex justify-content-between">
    <h5>{{Name}}{{#if Ritual}} (rit){{/if}}{{#if Concentration}} (concentration){{/if}}</h5>
    {{#if (equals UserId 0)}}{{else}}<button type="button" width="40px" height="40px" style="background: transparent; border: 0px solid transparent; margin-left: auto;" class="deleteBtn"><img src="/images/icons/subtraction.png" width="30px" alt="delete"></button>{{/if}}
  </div>
    <div class="card-body">
      <img class="card-img h-15 cardImage" src="/images/icons/spells/{{school}}.png" alt="Card image"
        style="height:60px;">
      <h5 class="card-title">{{school}} {{#if (numEquals Level 0)}}Cantrip{{else}}Level {{Level}}{{/if}}</h5>
      <p class="card-text">{{#trim}}{{../Description}}{{/trim}}</p>
    </div>
    <input type="text" hidden name="choice">
  </form>
  {{/each}}
</div>

<script src="/scripts/spellDeleter.js"></script>
{{!-- <script src="/scripts/cardPicker.js"></script> --}}